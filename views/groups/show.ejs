<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title><%= group.name %></title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.png" />
    <meta name="theme-color" content="#ef4444" />
    <meta
      name="description"
      content="Detalles del grupo <%= group.name %>: participantes, invitación y estado del sorteo de amigo invisible."
    />
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400;700&display=swap" />
  </head>
  <body class="bg-gray-50 min-h-screen flex flex-col">
    <nav class="bg-white shadow-sm">
      <div
        class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between"
      >
        <a href="/dashboard" class="text-blue-600 hover:underline">Volver</a>
        <h1 class="text-xl font-semibold text-red-600 flex items-center gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6z"
            />
          </svg>
          Amigo Invisible
        </h1>
      </div>
    </nav>

    <main class="max-w-5xl mx-auto px-4 py-8">
      <%- include('../partials/flash') %>

      <header class="bg-white shadow rounded-lg p-6 mb-6">
        <div class="flex items-start justify-between">
          <div class="flex items-start">
            <span class="mr-3" style="color: <%= group.color || '#DC2626' %>"
              ><%- renderGroupIcon(group.icon, "text-4xl") %></span
            >
            <div>
              <h2 class="text-2xl font-bold text-gray-900">
                <%= group.name %>
              </h2>
              <p class="text-gray-600 mt-1"><%= group.description || '' %></p>
              <p class="mt-2 text-sm">
                Estado: <% if (group.drawnAt) { %>
                <span
                  class="px-2 py-1 rounded-full text-xs bg-green-100 text-green-800"
                  >Sorteado</span
                >
                <% } else { %>
                <span
                  class="px-2 py-1 rounded-full text-xs bg-orange-100 text-orange-800"
                  >Pendiente</span
                >
                <% } %>
              </p>
            </div>
          </div>
          <% if (!group.drawnAt && group.adminUserId === currentUser.id) { %>
          <form method="post" action="/groups/<%= group.id %>/draw">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
            <button
              type="submit"
              class="inline-flex items-center gap-2 px-4 py-2 rounded-md bg-green-600 text-white hover:bg-green-700"
            >
              <%- renderIcon("dice", "text-base") %> Iniciar sorteo
            </button>
          </form>
          <% } %>
        </div>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <section class="bg-white shadow rounded-lg p-6 lg:col-span-2">
          <h3 class="text-lg font-semibold mb-4">Detalles</h3>
          <dl class="divide-y divide-gray-200">
            <% if (group.priceMax) { %>
            <div class="py-3 grid grid-cols-3 gap-4">
              <dt class="text-sm font-medium text-gray-500">Precio máximo</dt>
              <dd class="mt-0 text-sm text-gray-900 col-span-2">
                <%= group.priceMax %>
              </dd>
            </div>
            <% } %> <% if (group.eventDate) { %>
            <div class="py-3 grid grid-cols-3 gap-4">
              <dt class="text-sm font-medium text-gray-500">Evento</dt>
              <dd class="mt-0 text-sm text-gray-900 col-span-2">
                <%= dayjs(group.eventDate).format('YYYY-MM-DD') %>
              </dd>
            </div>
            <% } %> <% if (group.drawDeadline) { %>
            <div class="py-3 grid grid-cols-3 gap-4">
              <dt class="text-sm font-medium text-gray-500">
                Límite inscripción
              </dt>
              <dd class="mt-0 text-sm text-gray-900 col-span-2">
                <%= dayjs(group.drawDeadline).format('YYYY-MM-DD') %>
              </dd>
            </div>
            <% } %> <% if (group.rules) { %>
            <div class="py-3 grid grid-cols-3 gap-4">
              <dt class="text-sm font-medium text-gray-500">Reglas</dt>
              <dd
                class="mt-0 text-sm text-gray-900 col-span-2 whitespace-pre-line"
              >
                <%= group.rules %>
              </dd>
            </div>
            <% } %>
            <div class="py-3 grid grid-cols-3 gap-4">
              <dt class="text-sm font-medium text-gray-500">Invitación</dt>
              <dd class="mt-0 text-sm text-gray-900 col-span-2">
                <div class="bg-gray-100 rounded px-3 py-2 break-all">
                  <%= `${config?.baseUrl || ''}/join/${group.joinToken}` %>
                </div>
                <a
                  class="text-blue-600 hover:underline inline-block mt-2"
                  href="<%= `${config?.baseUrl || ''}/join/${group.joinToken}` %>"
                  >Abrir enlace</a
                >
              </dd>
            </div>
          </dl>
        </section>

        <section class="bg-white shadow rounded-lg p-6">
          <h3 class="text-lg font-semibold mb-4">
            Participantes (<%= participantNames.length %>)
          </h3>
          <ul class="list-disc pl-5 space-y-1 text-gray-800">
            <% participantNames.forEach(name => { %>
            <li><%= name %></li>
            <% }) %>
          </ul>
        </section>
      </div>

      <section class="bg-white shadow rounded-lg p-6 mt-6">
        <h3 class="text-lg font-semibold mb-2">Tu resultado</h3>
        <% if (group.drawnAt && receiverName) { %>
        <p>
          Tu amigo invisible es:
          <span class="font-semibold"><%= receiverName %></span>
        </p>
        <% } else if (!group.drawnAt) { %>
        <p class="text-gray-600">Aún no se ha realizado el sorteo.</p>
        <% } else { %>
        <p class="text-gray-600">No se encontró asignación.</p>
        <% } %>
      </section>
    </main>
    <%- include('../partials/footer') %>
  </body>
</html>
